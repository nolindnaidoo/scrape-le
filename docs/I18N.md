# Internationalization (i18n) Guide

**Version**: 1.1.0  
**Last Updated**: 2025-10-13

## Overview

Scrape-LE uses VS Code's native i18n system (`vscode-nls`) with `MessageFormat.file` for all user-facing strings. This enables easy localization to multiple languages while maintaining type-safety and developer productivity.

## Current Language Support

- **English (en)**: Full support (base language)
- **Future Languages**: Community contributions welcome

## Architecture

### Localization System

Scrape-LE follows VS Code's recommended i18n patterns:

1. **Manifest Strings**: Defined in `package.nls.json` with `manifest.*` prefix
2. **Runtime Strings**: Used in code with `runtime.*` prefix
3. **MessageFormat**: Enables dynamic placeholders and ICU message format

### File Structure

```
scrape-le/
├── package.nls.json          # Base English strings (root)
├── package.nls.{locale}.json # Translation files (future)
└── src/
    └── i18n/
        └── package.nls.json  # Build source for manifest strings
```

## Key Naming Conventions

### Manifest Keys

All strings used in `package.json` must:

- Use the `manifest.*` prefix
- Follow the pattern: `manifest.{category}.{subcategory}.{property}`
- Be referenced in package.json via `%key%` syntax

Examples:

```json
{
  "manifest.ext.name": "Scrape-LE",
  "manifest.ext.description": "Zero Hassle Scrapeability Check...",
  "manifest.command.check-url.title": "Check URL Scrapeability",
  "manifest.settings.browser.timeout.desc": "Browser navigation timeout..."
}
```

### Runtime Keys

All strings used in TypeScript code must:

- Use the `runtime.*` prefix
- Follow the pattern: `runtime.{category}.{action}.{detail}`
- Support placeholder substitution

Examples:

```json
{
  "runtime.check.start": "Checking URL scrapeability...",
  "runtime.check.success": "✅ Success: {0} - {1}ms",
  "runtime.check.error": "❌ Failed: {0}",
  "runtime.setup.browser.installing": "Installing Chromium browser...",
  "runtime.setup.browser.complete": "✅ Browser setup complete"
}
```

## Implementation

### In Code (TypeScript)

```typescript
import * as nls from "vscode-nls";

// Configure localization with MessageFormat
const localize = nls.config({ messageFormat: nls.MessageFormat.file })();

// Simple string
const message = localize(
  "runtime.check.start",
  "Checking URL scrapeability..."
);

// With placeholder substitution
const success = localize(
  "runtime.check.success",
  "✅ Success: {0} - {1}ms",
  result.url,
  result.loadTimeMs
);

// Multiple placeholders
const error = localize(
  "runtime.detector.found",
  "{0} detected: {1}",
  detectorName,
  details
);
```

### In package.json

```json
{
  "displayName": "%manifest.ext.name%",
  "description": "%manifest.ext.description%",
  "commands": [
    {
      "command": "scrape-le.checkUrl",
      "title": "%manifest.command.check-url.title%",
      "category": "%manifest.command.category%"
    }
  ]
}
```

## Localization Categories

### 1. Extension Metadata

```json
{
  "manifest.ext.name": "Scrape-LE",
  "manifest.ext.description": "Zero Hassle Scrapeability Check...",
  "manifest.command.category": "Scrape-LE"
}
```

### 2. Commands

```json
{
  "manifest.command.check-url.title": "Check URL Scrapeability",
  "manifest.command.check-selection.title": "Check Selected URL",
  "manifest.command.setup.title": "Setup Browser",
  "manifest.command.settings.title": "Open Settings",
  "manifest.command.export.title": "Export Last Results"
}
```

### 3. Configuration Settings

```json
{
  "manifest.settings.title": "Scrape-LE Settings",
  "manifest.settings.browser.timeout.desc": "Browser navigation timeout...",
  "manifest.settings.screenshot.enabled.desc": "Enable automatic screenshot...",
  "manifest.settings.detections.antibot.desc": "Detect anti-bot protection..."
}
```

### 4. Runtime Messages

```json
{
  "runtime.check.start": "Checking URL scrapeability...",
  "runtime.check.success": "✅ Success: {0} - {1}ms",
  "runtime.check.error": "❌ Failed: {0}",
  "runtime.setup.browser.checking": "Checking browser installation...",
  "runtime.setup.browser.installing": "Installing Chromium..."
}
```

## Message Format Guidelines

### Active Voice

✅ **Good**: "Checking URL scrapeability..."  
❌ **Bad**: "URL scrapeability is being checked..."

### Concise & Clear

✅ **Good**: "Browser setup complete"  
❌ **Bad**: "The browser installation process has been successfully completed"

### Consistent Terminology

- **URL** (not "web address", "link", "site")
- **Scrapeability** (not "scrapability", "accessibility")
- **Browser** (not "web browser", "headless browser")
- **Screenshot** (not "screen capture", "image")

### Status Indicators

Use consistent emoji/symbols:

- ✅ Success
- ❌ Error
- ⚠️ Warning
- ℹ️ Info

## Placeholder Formatting

### Positional Arguments

```typescript
// {0}, {1}, {2} for placeholder positions
localize("runtime.check.success", "✅ Success: {0} - {1}ms", url, time);
```

### Number Formatting

```typescript
// Use ICU message format for numbers
localize(
  "runtime.results.count",
  "Found {0, plural, =0 {no issues} =1 {one issue} other {# issues}}",
  count
);
```

### Date/Time Formatting

```typescript
// Use ICU message format for dates
localize(
  "runtime.check.timestamp",
  "Checked at {0, date, short} {0, time, short}",
  new Date()
);
```

## Adding New Localizations

### 1. Add to Base File

Edit `package.nls.json`:

```json
{
  "runtime.new.feature.message": "New feature message with {0} placeholder"
}
```

### 2. Use in Code

```typescript
const message = localize(
  "runtime.new.feature.message",
  "New feature message with {0} placeholder",
  value
);
```

### 3. Build & Test

```bash
bun run build
bun run vscode:prepublish
```

## Translation Workflow (Future)

### For Contributors

1. **Create Translation File**: `package.nls.{locale}.json`
2. **Copy Base Structure**: From `package.nls.json`
3. **Translate Strings**: Keep placeholders ({0}, {1}) intact
4. **Test**: Install with locale and verify
5. **Submit PR**: With translation file

### Supported Locales

Future support planned for:

- **de**: German
- **es**: Spanish
- **fr**: French
- **ja**: Japanese
- **zh-cn**: Simplified Chinese
- **ru**: Russian
- **pt-br**: Brazilian Portuguese
- **it**: Italian
- **ko**: Korean

## Testing Localizations

### Manual Testing

1. Change VS Code display language
2. Reload window
3. Verify all strings are translated
4. Test with placeholders containing various data types

### Automated Testing

```typescript
import * as nls from "vscode-nls";

describe("Localization", () => {
  it("should load localized strings", () => {
    const localize = nls.config({
      messageFormat: nls.MessageFormat.file,
    })();

    const message = localize("runtime.check.start", "Default message");
    expect(message).toBeDefined();
  });
});
```

## Common Patterns

### Error Messages

```typescript
// Always provide context
localize(
  "runtime.error.browser.launch",
  "Failed to launch browser: {0}",
  error.message
);
```

### Progress Messages

```typescript
// Use present continuous for ongoing actions
localize("runtime.check.progress", "Checking {0}...", url);
```

### Success Messages

```typescript
// Use past tense for completed actions
localize("runtime.check.complete", "Checked {0} successfully", url);
```

### Settings Descriptions

```typescript
// Be descriptive and include constraints
localize(
  "manifest.settings.timeout.desc",
  "Browser navigation timeout in milliseconds (5000-120000)"
);
```

## Best Practices

### DO

✅ Use descriptive keys that explain the string's purpose  
✅ Include default English text in localize() calls  
✅ Use placeholders for dynamic content  
✅ Keep strings concise and actionable  
✅ Use consistent terminology throughout  
✅ Test with extreme placeholder values (very long, special characters)

### DON'T

❌ Hardcode user-visible strings in code  
❌ Concatenate translated strings  
❌ Use string interpolation instead of placeholders  
❌ Create unnecessarily long or complex messages  
❌ Mix technical and user-facing language  
❌ Assume English sentence structure in other languages

## Troubleshooting

### Strings Not Appearing

1. **Check key prefix**: Must be `manifest.*` or `runtime.*`
2. **Verify file location**: `package.nls.json` at root
3. **Rebuild**: Run `bun run build`
4. **Reload VS Code**: Developer: Reload Window

### Placeholders Not Substituting

1. **Use correct syntax**: `{0}`, `{1}`, not `$0` or `%s`
2. **Match argument count**: Provide all placeholder values
3. **Check MessageFormat**: Must use `MessageFormat.file`

### Missing Translations

1. **Fallback to English**: Automatic if translation missing
2. **Check locale code**: Must match VS Code locale exactly
3. **Verify JSON syntax**: Invalid JSON breaks entire file

## Resources

### Documentation

- [VS Code i18n Guide](https://code.visualstudio.com/api/references/vscode-api#l10n)
- [vscode-nls Package](https://github.com/microsoft/vscode-nls)
- [ICU Message Format](https://unicode-org.github.io/icu/userguide/format_parse/messages/)

### Tools

- [VS Code Language Packs](https://code.visualstudio.com/docs/getstarted/locales)
- [i18n Ally Extension](https://marketplace.visualstudio.com/items?itemName=lokalise.i18n-ally)

---

## Contributing Translations

We welcome community translations! To contribute:

1. **Create Issue**: Propose new language
2. **Fork Repository**: Create feature branch
3. **Add Translation**: Create `package.nls.{locale}.json`
4. **Test Locally**: Verify with VS Code language pack
5. **Submit PR**: Include screenshots of tested strings

**Contact**: Open an issue at [scrape-le/issues](https://github.com/nolindnaidoo/scrape-le/issues)

---

**Last Updated**: 2025-10-13  
**Version**: 1.1.0
